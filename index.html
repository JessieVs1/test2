<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Koelkast App met Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = 'https://jouw-project-id.supabase.co'; // Vervang dit
    const supabaseKey = 'jouw-anon-public-key'; // Vervang dit
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const gebruikers = {};
    let actieveGebruiker = null;
    let doelActie = '';

    async function laadGebruikers() {
      const { data, error } = await supabase.from('gebruikers').select('*');
      if (!error) {
        data.forEach(g => gebruikers[g.code] = g.naam);
      }
    }

    async function toonCodePopup(actie) {
      doelActie = actie;
      document.getElementById('codeOverlay').classList.add('active');
    }

    async function verifieerCode() {
      const code = document.getElementById('codeInput').value.trim();
      document.getElementById('codeInput').value = '';
      document.getElementById('codeOverlay').classList.remove('active');

      if (doelActie === 'beheer' && code === 'Admin123') {
        laadVoorraad();
        laadLogs();
        laadGebruikersTabel();
        wisselScherm('beheerscherm');
      } else if (doelActie === 'bestellen' && gebruikers[code]) {
        actieveGebruiker = code;
        laadProducten();
        wisselScherm('bestelscherm');
      } else {
        alert('Ongeldige code');
      }
    }

    function wisselScherm(id) {
      document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    async function laadProducten() {
      const { data: producten, error } = await supabase.from('producten').select('*');
      const container = document.getElementById('productContainer');
      container.innerHTML = '';
      producten.forEach(product => {
        const tile = document.createElement('div');
        tile.className = 'product-tile';
        tile.innerHTML = `<strong>${product.naam}</strong><p>Voorraad: ${product.aantal}</p>`;
        const knop = document.createElement('button');
        knop.innerText = 'Bestel';
        knop.onclick = () => bestelProduct(product);
        tile.appendChild(knop);
        container.appendChild(tile);
      });
    }

    async function bestelProduct(product) {
      if (product.aantal <= 0) {
        alert('Niet op voorraad!');
        return;
      }

      await supabase.from('producten').update({ aantal: product.aantal - 1 }).eq('id', product.id);
      await supabase.from('logs').insert([{ gebruiker_code: actieveGebruiker, product_naam: product.naam }]);
      laadProducten();
      document.getElementById('bestelMelding').textContent = 'Bestelling geplaatst!';
      setTimeout(() => document.getElementById('bestelMelding').textContent = '', 3000);
    }

    async function laadVoorraad() {
      const { data: producten } = await supabase.from('producten').select('*');
      const tbody = document.querySelector('#voorraadTabel tbody');
      tbody.innerHTML = '';
      producten.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.naam}</td>
          <td><input type="number" value="${p.aantal}" onchange="wijzigVoorraad('${p.id}', this.value)"></td>
          <td><button class="verwijder" onclick="verwijderProduct('${p.id}')">Verwijder</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function wijzigVoorraad(id, waarde) {
      await supabase.from('producten').update({ aantal: parseInt(waarde) }).eq('id', id);
    }

    async function verwijderProduct(id) {
      await supabase.from('producten').delete().eq('id', id);
      laadVoorraad();
    }

    async function laadLogs() {
      const { data: logs } = await supabase.from('logs').select('*').order('tijd', { ascending: false });
      const tbody = document.querySelector('#logsTabel tbody');
      tbody.innerHTML = '';
      logs.forEach(log => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${gebruikers[log.gebruiker_code] || 'Onbekend'}</td><td>${log.product_naam}</td><td>${new Date(log.tijd).toLocaleString()}</td>`;
        tbody.appendChild(tr);
      });
    }

    async function laadGebruikersTabel() {
      const { data } = await supabase.from('gebruikers').select('*');
      const tbody = document.getElementById('gebruikersTabel');
      tbody.innerHTML = '';
      data.forEach(g => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${g.code}</td><td>${g.naam}</td>`;
        tbody.appendChild(tr);
      });
    }

    window.onload = laadGebruikers;
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { display: none; padding: 20px; }
    .container.active { display: block; }
    .product-tile { border: 1px solid #ccc; padding: 10px; margin: 10px; display: inline-block; width: 150px; text-align: center; }
    #codeOverlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; }
    #codeOverlay.active { display: flex; }
    #codeOverlay div { background: white; padding: 20px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .verwijder { color: red; }
  </style>
</head>
<body>
  <div id="startscherm" class="container active">
    <h1>Welkom bij de Koelkast</h1>
    <button onclick="toonCodePopup('bestellen')">Bestellen</button>
    <button onclick="toonCodePopup('beheer')">Beheer</button>
  </div>

  <div id="bestelscherm" class="container">
    <h2>Bestellen</h2>
    <div id="productContainer"></div>
    <p id="bestelMelding"></p>
    <button onclick="wisselScherm('startscherm')">Terug</button>
  </div>

  <div id="beheerscherm" class="container">
    <h2>Voorraadbeheer</h2>
    <table id="voorraadTabel">
      <thead><tr><th>Product</th><th>Aantal</th><th>Acties</th></tr></thead>
      <tbody></tbody>
    </table>
    <h2>Bestelgeschiedenis</h2>
    <table id="logsTabel">
      <thead><tr><th>Naam</th><th>Product</th><th>Tijd</th></tr></thead>
      <tbody></tbody>
    </table>
    <h2>Gebruikers</h2>
    <table>
      <thead><tr><th>Code</th><th>Naam</th></tr></thead>
      <tbody id="gebruikersTabel"></tbody>
    </table>
    <button onclick="wisselScherm('startscherm')">Uitloggen</button>
  </div>

  <div id="codeOverlay">
    <div>
      <h3>Voer je code in</h3>
      <input id="codeInput" type="text" placeholder="Gebruikers- of beheercode">
      <button onclick="verifieerCode()">OK</button>
    </div>
  </div>
</body>
</html>
